# タイトル 「約束の夏(仮)」

| | |
| :--- | :--- |
| **開発エンジン** | Unreal Engine 5.3.2 |
| **開発期間** | 約 2ヶ月 (2025年 6月 1日 ～ 8月 2日)現在 |
| **開発規模** | ほぼ個人開発、チーム開発の経験も積みたいと思い、現在はアニメーションエンジニアの友人と二人で少しずつ開発を進めています|
| **担当範囲** | 全てのプログラム、ゲームデザイン、シナリオ |
| **ソースコード** | [Repository](https://github.com/kyosuke121/MyUE5Project-Game) |
| **動画** | YouTubeプレイ動画へのリンク **※今後追加予定** |

---
## 概要 (Overview)
Unreal Engine 5を用いて、約 2ヶ月程で制作した、ノスタルジックな夏の探索アドベンチャーゲームです。夏休みの最後の3日間、
プレイヤーは、時間の流れを感じながら小さな田舎町を探索し、NPCとの交流を通じて「忘れられた約束」の謎を解き明かしていきます。

<img width="1915" height="986" alt="スクリーンショット 2025-08-06 011848" src="https://github.com/user-attachments/assets/a698f171-ceb3-46b9-a954-96c1d02c0c83" />
※夏がテーマなのに桜の木があるのは、私が桜が好きだからどうしても使いたかっただけです。初めてのゲーム制作で、プロトタイプのゲームなので、多めに見てもらえると幸いです。

---
### 技術的なハイライト (Technical Highlights)

このプロジェクトのコアシステムは、全て**ブループリント**を用いて設計・実装しました。これにより、迅速なイテレーションと、複雑なゲームロジックの視覚的な管理を実現しています。習熟も兼ねて今後、実装完了している一部の機能及び新機能をC++で修正、実装予定。

### 1. 動的な時間経過とイベント管理システム (Blueprint)

- **GameStateによる中央集権的な時間管理:**
  - `GameState`ブループリント内に、`Event Tick`で実行される時間経過（日・時・分）のコアロジックを実装。ゲーム全体の時間を一元管理し、安定した動作を確保しました。

- **時間帯に応じた動的な環境変化:**
  - ゲーム内の時間経過と完全に同期し、レベルの環境光がリアルタイムかつ滑らかに変化します。
  - **1日の進行度を0.0～1.0の割合(`DayProgress`)として計算**し、その値を基に**太陽の回転角度 (`Directional Light` のPitch)を連続的に更新。**これにより、太陽が空を移動する軌道を自然に表現しています。**
  - さらに、この太陽の角度情報を基に `BP_Sky_Sphere` の **`Update Sun Direction`** 関数を毎フレーム呼び出すことで、空の色合いが朝焼けから日中、夕焼け、そして夜空へと**継ぎ目なく滑らかに**移り変わる、没入感の高い環境を実現しました。
  - **レベルアクタとの疎結合な連携:** `GameState`から直接レベルのアクタ（太陽光や空）を参照するのではなく、専用の管理アクタ（`BP_LevelLightingManager`）を介して参照を受け渡す設計を採用。これにより、`GameState`はレベル固有の情報から独立し、再利用性と保守性を高めています。

- **イベントディスパッチャ / 関数による連携:**
  - `GameState`が持つ「時間帯の変更」や「日付の変更」といったイベントを、ブループリントの各アクター（NPC、環境オブジェクト等）が受け取り、自律的に状態を変化させる疎結合な設計を構築しました。
- **今後の展望 (C++化):**
  - 現在ブループリントで実装されているこの時間管理システムは、パフォーマンスと保守性をさらに向上させるため、将来的にC++でリファクタリングする計画です。コアロジックをC++に移行することで、より堅牢なシステムを目指します。


### 2. データ駆動型の高度な会話・フラグシステム (Blueprint)

- **GameStateによる進行フラグの一元管理:**
  - 物語の進行度を管理する全てのBooleanフラグ（例: `bGotFlagA_SayokosMemory`）を **`GameState`に集約。** これにより、どのブループリントからでも現在の物語の進行状況を安全に参照・更新できる、信頼性の高い状態管理の基盤を構築しました。

- **構造体(Struct)の活用:**
  - `S_DialogueEntry`構造体を定義し、会話のセリフ、発生条件（日付、時間帯、**必須フラグ**）、そして達成時に`GameState`にセットされる**達成フラグ**をデータとして一元管理。これにより、プログラマー以外でも容易にイベントの追加・変更が可能なワークフローを実現しました。

- **優先度付き会話選択ロジック:**
  - NPCとのインタラクト時に、プレイヤーの状況に応じて最も適切な会話を動的に選択するロジックを実装しました。
  - この複雑な処理は、**責務を明確に分離した複数の関数**に分割することで、高い可読性、保守性、再利用性を実現しています。メインの処理フローは以下の通りです。

<img width="1518" height="258" alt="スクリーンショット 2025-08-06 002357" src="https://github.com/user-attachments/assets/870b1854-9857-46c1-8002-072bafa68b64" />


- **メイン処理フロー (`ExecuteTalkAction_Func`):**
  1.  まず、**`FindSpecialDialogue`** 関数を呼び出し、「前提条件を満たす特別な会話(`RequiredFlag`)」を最優先で探します。
  2.  もし見つかれば (`bSuccess` が `True`)、その会話データをローカル変数に保存し、最終ステップに進みます。
  3.  もし見つからなければ、次に **`FindNormalDialogue`** 関数を呼び出し、「通常の会話」を探します。
  4.  最終的に表示すべき会話データが見つかった場合にのみ、**`CreateDialogueWidget`** 関数を呼び出して会話を開始します。

<details>
<summary><b>詳細: `FindSpecialDialogue` 関数の実装 (クリックで展開)</b></summary>

<img width="1498" height="710" alt="スクリーンショット 2025-08-06 004111" src="https://github.com/user-attachments/assets/b39f264b-34d0-4dcd-a930-bf1d1823cdc8" />


- **責務:** 「特別な会話」の探索のみを担当。
- **入力:** NPCの会話リスト、現在の日付、時間帯、`GameState`への参照を受け取ります。
- **処理:** `For Each Loop` を用いて、日付、時間帯、`RequiredFlag`の有無、そして`GameState`に保存された進行フラグの状態を複合的にチェックします。
- **出力:** 条件を完全に満たす最初の会話データと、成功したかどうかを示す`Boolean`値を返します。`Return Node`が実行された時点で探索は即座に終了します。

</details>

<details>
<summary><b>詳細: `FindNormalDialogue` 関数の実装 (クリックで展開)</b></summary>

<img width="1731" height="657" alt="スクリーンショット 2025-08-06 004502" src="https://github.com/user-attachments/assets/7a581674-7db1-4c39-b758-9ddd318996ab" />


- **責務:** 「通常の会話」の探索のみを担当。
- **入力:** NPCの会話リスト、現在の日付、時間帯を受け取ります。
- **処理:** `For Each Loop` を用いて、`RequiredFlag` が設定されていない通常会話の中から、日付と時間帯が一致するものを探します。
- **出力:** 条件を満たす最初の会話データと、成功したかどうか(通常会話が見つかった)を示す`Boolean`値を返します。

</details>


### 3. **物語主導の時間停止システム (Blueprint)**
- **複合的な条件判定:**
  - 「会話中」という短期的な状態と、「その時間帯に未達成の必須イベントが存在するか」という長期的な状態を`GameState`で一元管理。
  - `GameState`内に実装した **`CheckForRequiredDialogueNow`関数** が、全NPCの全会話データをリアルタイムで検証。日付、時間帯、`RequiredFlag`と`GrantsFlag`の状態を複合的に判定し、「今、時間を止めるべきか」を動的に決定します。
  - `Event Tick`では、この関数の結果と会話中の状態を`OR`と`NOT`で組み合わせることで、プレイヤーが重要な物語を見逃すことなく、自分のペースでゲームを進められるプレイ体験を提供します。


### 4. **Git / Git LFSによるバージョン管理**
- **チーム開発環境の構築:** GitHub上にプライベートリポジトリを設置し、`.gitignore` (Unreal Engine用) と `.gitattributes` (Git LFS用) を適切に設定。
- **コンフリクト解決とファイルロック:** バイナリファイル（`.umap`, `.uasset`）で発生したマージコンフリクトを、`git checkout --theirs/--ours` を用いて解決。再発防止策として、主要アセットを編集する際のファイルロック（`git lfs lock`）のチームルールを導入・実践しました。

---
## ゲームの特徴 (Features)

- **時間と共に表情を変える世界:** 朝・昼・夕方・夜で太陽の角度や光、空の色が滑らかに変化します。
- **生きている町:** NPCは決まった時間、決まった場所にだけ姿を現し、世界の生活感を演出します。
- **分岐する物語:** プレイヤーの行動（誰と話し、何を発見したか）によって、3日目の朝の会話が変化し、結末が「パーフェクトエンディング」と「通常エンディング」に分岐します。
- **クライマックスの演出:** 物語の進行度に応じて、特別なオブジェクトやNPCが特定の時間に出現し、物語の最終盤を盛り上げます。

---
## 今後の課題 / 実装予定 (Future Work)

このプロジェクトはコアシステムの完成に重点を置いていますが、さらにゲーム体験を向上させるため、以下の機能追加を計画しています。

- **キャラクターモデルの差し替え**
  - 現在プレースホルダーとして使用しているUE5 Mannequinから、物語の世界観に合ったオリジナルのキャラクターモデル（主人公、NPC）に差し替える。

- **エンディング演出の強化**
  - パーフェクトエンディング到達時に、現在のBGMから専用の特別なBGMに切り替えるロジックを実装し、クライマックスをより感動的に演出する。

- **サウンドエフェクトの拡充**
  - プレイヤーキャラクターの足音（歩く地面の種類によって音が変わるシステムを含む）を追加。
  - UIの操作音や、ドアの開閉音など、世界とのインタラクションに対する効果音を追加し、没入感を高める。

- **タイトル画面の改善**
  - 現在の基本的なタイトル画面に、アニメーションやBGMを追加し、ゲームの第一印象をより魅力的なものにする。

- **新規ゲームプレイシステムの追加: 昆虫採集**
  - **ゲーム世界の探索をさらに楽しくするための収集要素として、** 昆虫採集システムを新たに追加する。
  - **実装計画:**
    - `BP_Insect` アクタを作成し、虫の出現時間帯や場所を管理。
    - プレイヤーが虫あみを使用するアクションと、当たり判定のロジックを実装。
  
---
### 開発環境

- **エンジン:** Unreal Engine 5.3.2
- **IDE:** Visual Studio 2022
- **バージョン管理:** Git / Git LFS (Source Control: GitHub)
  
---
## 使用アセット・ツール (Assets & Tools)

### 3Dアセット
- **町:** [Japan Countryside](https://www.unrealengine.com/marketplace/ja/product/japan-countryside) - (アセットストアへのリンク)
  - *Unreal Engine Fab(Marketplace)で購入したアセットです。日本の田舎町の美しい景観を構築するために使用しました。*
- **キャラクター:** [UE5 Mannequin (Manny & Quinn)](https://docs.unrealengine.com/5.0/ja/real-time-character-rigging-with-control-rig-in-unreal-engine/) - (公式ドキュメントへのリンク)
  - *Unreal Engine 5にデフォルトで含まれているキャラクターモデルとスケルトンをベースとして使用しました。*

### サウンド
- **BGM:**
  - [DOVA-SYNDROME] (https://dova-s.jp/bgm/play18917.html)
  - **作曲者: [蒲鉾さちこ] 様 - 曲名: [初夏の風を感じて…]**
    
  - [Springin] (https://www.springin.org/sound-stock/subcategory/cicada/)
  - **作曲者: 不明 - 曲名: [ミンミンゼミヒグラシループ]**

- **効果音:** [効果音ラボ](https://soundeffect-lab.info/)※実装予定
  - **[例: 歩行音、UI決定音などに使用]**

### タイトル画像
- **[ゲームまてりあるず]:** (https://game-materials.com/seaside-residential-area/)
  - **制作者:** [くらげさん] 様 - 画像名: [海沿いの住宅街]

### フォント
- **[フォント名]:** [モギハ・ペン字]
  - **配布元URL:** (https://ahito.com/item/desktop/font/mogihaPen/)
  - **制作者:** [花の星] 様
  
